<mvc:View
  controllerName="yt_joule.controller.Main"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core"
  xmlns:smartTable="sap.ui.comp.smarttable"
  xmlns:f="sap.f"
  xmlns:layout="sap.ui.layout">

  <App id="app">
    <pages>
      <Page id="listPage" enableScrolling="false" class="sapUiContentPadding">
        
        <content>
          <f:DynamicPage id="dynamicPageId" headerExpanded="true">
            
            <f:title>
              <f:DynamicPageTitle>
                <f:heading>
                  <Title text="Flights" class="sapMH1Style"/>
                </f:heading>
                <f:actions>
                  <Button 
                    text="Create" 
                    type="Emphasized" 
                    icon="sap-icon://add" 
                    press="onCreateFlight"/>
                  <Button 
                    text="Export" 
                    icon="sap-icon://excel-attachment"
                    press="onExport"/>
                </f:actions>
              </f:DynamicPageTitle>
            </f:title>

            <f:content>
              <Table
                id="flightsTable"
                inset="false"
                mode="SingleSelectMaster"
                width="100%"
                growing="true"
                growingThreshold="20"
                items="{
                  path: '/Flights',
                  parameters: {
                    $count: true,
                    $orderby: 'flightNumber'
                  }
                }"
                class="sapFDynamicPageAlignContent"
                alternateRowColors="true">
                
                <headerToolbar>
                  <OverflowToolbar>
                    <Title text="Items ({$count})" level="H2"/>
                    <ToolbarSpacer/>
                    <Button icon="sap-icon://sort" text="Sort" press="onSort"/>
                    <Button icon="sap-icon://filter" text="Filter" press="onOpenFilterDialog"/>
                    <Button icon="sap-icon://group-2" text="Group" press="onGroup"/>
                    <Button icon="sap-icon://action-settings" tooltip="Table Settings" press="onTableSettings"/>
                  </OverflowToolbar>
                </headerToolbar>

                <columns>
                  <Column width="8rem" sortProperty="flightNumber" filterProperty="flightNumber">
                    <Text text="Flight Number"/>
                  </Column>
                  <Column width="10rem" sortProperty="departure" filterProperty="departure">
                    <Text text="Departure"/>
                  </Column>
                  <Column width="10rem" sortProperty="arrival" filterProperty="arrival">
                    <Text text="Arrival"/>
                  </Column>
                  <Column width="12rem" sortProperty="departureTime">
                    <Text text="Departure Time"/>
                  </Column>
                  <Column width="12rem" sortProperty="arrivalTime">
                    <Text text="Arrival Time"/>
                  </Column>
                  <Column width="8rem" sortProperty="status" filterProperty="status">
                    <Text text="Status"/>
                  </Column>
                  <Column width="10rem" sortProperty="airline">
                    <Text text="Airline"/>
                  </Column>
                </columns>

                <items>
                  <ColumnListItem type="Navigation" press="onSelectFlight">
                    <cells>
                      <Text text="{flightNumber}"/>
                      <Text text="{departure}"/>
                      <Text text="{arrival}"/>
                      <Text text="{path: 'departureTime', type: 'sap.ui.model.odata.type.DateTimeOffset'}"/>
                      <Text text="{path: 'arrivalTime', type: 'sap.ui.model.odata.type.DateTimeOffset'}"/>
                      <ObjectStatus 
                        text="{status}" 
                        state="{path: 'status', formatter: '.formatStatusState'}"/>
                      <Text text="{airline}"/>
                    </cells>
                  </ColumnListItem>
                </items>
              </Table>
            </f:content>

          </f:DynamicPage>
        </content>
        
        <Button
          id="chatBotButton"
          icon="sap-icon://paper-plane"
          type="Emphasized"
          class="sapUiSmallMarginBottom chatBotButton"
          press="onToggleChat"
          tooltip="Open chat assistant"/>
        
        <Panel
          id="chatPanel"
          headerText="Flight Assistant"
          expandable="true"
          expanded="false"
          width="auto"
          class="sapUiSmallMargin chatPanel">
          <content>
            <ScrollContainer
              id="messageContainer"
              height="200px"
              vertical="true"
              class="sapUiSmallMargin">
              <!-- Messages will be added here dynamically -->
            </ScrollContainer>
            <Input
              id="chatInput"
              placeholder="Type your message here..."
              liveChange="onInputLiveChange"
              class="sapUiSmallMargin"
              value="{/chatInputValue}"/>
            <Button
              text="Send"
              press="onSendMessage"
              type="Emphasized"
              class="sapUiSmallMargin"
              enabled="{= ${/chatInputValue} !== '' }"/>
          </content>
        </Panel>
      </Page>
    </pages>
  </App>
</mvc:View>